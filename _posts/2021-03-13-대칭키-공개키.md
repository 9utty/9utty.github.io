---
title: "[Network] λ€μ±™ν‚¤μ™€ κ³µκ°ν‚¤ SSL λ™μ‘λ°©μ‹"
date: 2021-03-13 21:03:30 +0800
categories: [Computer Science, Network]
tags: [symmetric key, public key, ssl]
---



# λ€μΉ­ν‚¤μ™€ κ³µκ°ν‚¤

μ•”νΈν™” μ•κ³ λ¦¬μ¦μ μΆ…λ¥μΈ λ€μΉ­ν‚¤μ™€ κ³µκ°ν‚¤μ— λ€ν•΄ μ•μ•„λ³΄κ³  SSL λ™μ‘λ°©μ‹μ— λ€ν•΄ μ•μ•„λ³΄κ² μµλ‹λ‹¤. π

# **λ€μΉ­ν‚¤(Symmetric Key)**

> μ•”νΈν™”μ™€ λ³µνΈν™”μ— κ°™μ€ μ•”νΈν‚¤(λ€μΉ­ν‚¤)λ¥Ό μ‚¬μ©ν•λ” μ•κ³ λ¦¬μ¦

## λ€μΉ­ν‚¤μ μ¥μ κ³Ό λ‹¨μ 

### μ¥μ 

- ν‚¤ ν¬κΈ°κ°€ μƒλ€μ μΌλ΅ μ‘κ³  μ•”νΈ μ•κ³ λ¦¬μ¦ λ‚΄λ¶€ κµ¬μ΅°κ°€ λ‹¨μν•μ—¬, μ‹μ¤ν… κ°λ° ν™κ²½μ— μ©μ΄ν•κ³ , λΉ„λ€μΉ­ν‚¤(κ³µκ°ν‚¤) μ— λΉ„ν•΄ μ•”νΈν™”μ™€ λ³µνΈν™” μ†λ„κ°€ λΉ λ¥΄λ‹¤.

### λ‹¨μ 

- ν•μ§€λ§ κµν™ λ‹Ήμ‚¬μκ°„μ— λ™μΌν• ν‚¤λ¥Ό κ³µμ ν•΄μ•Ό ν•κΈ° λ•λ¬Έμ— ν‚¤ κ΄€λ¦¬μ μ–΄λ ¤μ›€μ΄ μκ³ , μ¦μ€ ν‚¤ λ³€κ²½μ΄ μλ” κ²½μ° λ¶νΈν•λ‹¤.
- λ””μ§€ν„Έ μ„λ… κΈ°λ²•μ— μ μ©μ΄ κ³¤λ€ν•κ³  μ•μ „μ„±μ„ λ¶„μ„ν•κΈ° μ–΄λ µκ³  μ¤‘μ¬μκ°€ ν•„μ”ν•λ‹¤.

```python
# λ¨Όμ € cryptographyμ—μ„ λ€μΉ­ν‚¤ μ•”νΈν™”λ¥Ό ν•  μ μλ” Fernetμ„ import ν•©λ‹λ‹¤.
from cryptography.fernet import Fernet

# Fernet.generate_key()λ¥Ό ν†µν•΄ ν‚¤λ¥Ό ν•λ‚ μƒμ„±ν•©λ‹λ‹¤. 
# λ€μΉ­ν‚¤ μƒμ„±
key = Fernet.generate_key() 
print('λ€μΉ­ν‚¤: ', key)
# μ•”νΈν™” κ³Όμ •
fernet = Fernet(key)
encrypt_str = fernet.encrypt(b"I want to eat")

print("μ•”νΈν™”λ λ¬Έμμ—΄:", encrypt_str)

# λ³µνΈν™” κ³Όμ •
decrypt_str = fernet.decrypt(encrypt_str)
print('λ³µνΈν™”λ λ¬Έμμ—΄:', decrypt_str)

### μ¶λ ¥ ####
# λ€μΉ­ν‚¤:  b'fZTFBgJmhA0POw0gI7A4aeXOyVl_zwf2SvqqVi1JOXg='
# μ•”νΈν™”λ λ¬Έμμ—΄: b'gAAAAABgTw78gay90IYHUR23bKNLddfYmBbKFlL_Mld1zoBAKkkM2PQCx3mqWHNCN3MNZXdb_l3UAj7AAqh0W3EPOdaHYItJSQ=='
# λ³µνΈν™”λ λ¬Έμμ—΄: b'I want to eat'
```

# **κ³µκ°ν‚¤(Public Key)**

> μ•”νΈν™”μ™€ λ³µνΈν™”μ— μ‚¬μ©ν•λ” μ•”νΈν‚¤λ¥Ό λ¶„λ¦¬ν• μ•κ³ λ¦¬μ¦

μμ‹ μ΄ κ°€μ§€κ³  μλ” κ³ μ ν• μ•”νΈν‚¤(λΉ„λ°€ν‚¤)λ΅λ§ λ³µνΈν™”ν•  μ μλ” μ•”νΈν‚¤(κ³µκ°ν‚¤)λ¥Ό λ€μ¤‘μ— κ³µκ°ν•¨

μ¦‰, κ³µκ°ν‚¤λ” λ„¤νΈμ›ν¬μ— κ³µμ ν•κ³  κ°μΈν‚¤λ” λ³ΈμΈλ§ λ³΄μ 

## **κ³µκ°ν‚¤ μ•”νΈν™” λ°©μ‹ μ§„ν–‰ κ³Όμ •**

1. Aκ°€ μ›Ή μƒμ— κ³µκ°λ 'Bμ κ³µκ°ν‚¤'λ¥Ό μ΄μ©ν•΄ ν‰λ¬Έμ„ μ•”νΈν™”ν•μ—¬ Bμ—κ² λ³΄λƒ„
2. Bλ” μμ‹ μ λΉ„λ°€ν‚¤λ΅ λ³µνΈν™”ν• ν‰λ¬Έμ„ ν™•μΈ, Aμ κ³µκ°ν‚¤λ΅ μ‘λ‹µμ„ μ•”νΈν™”ν•μ—¬ Aμ—κ° λ³΄λƒ„
3. Aλ” μμ‹ μ λΉ„λ°€ν‚¤λ΅ μ•”νΈν™”λ μ‘λ‹µλ¬Έμ„ λ³µνΈν™”ν•¨

λ€μΉ­ν‚¤μ λ‹¨μ μ„ μ™„λ²½ν•κ² ν•΄κ²°ν–μ§€λ§, μ•”νΈν™” λ³µνΈν™”κ°€ λ§¤μ° λ³µμ΅ν•¨

(μ•”νΈν™”ν•λ” ν‚¤κ°€ λ³µνΈν™”ν•λ” ν‚¤κ°€ μ„λ΅ λ‹¤λ¥΄κΈ° λ•λ¬Έ)

μ •λ¦¬ν•μλ©΄, μ•”νΈν™”λ” κ³µκ°ν‚¤λ¥Ό μ‚¬μ©ν•κ³  λ³µνΈν™” μ‹μ—λ” κ°μΈν‚¤λ¥Ό μ‚¬μ©ν•λ‹¤. 

## κ³µκ°ν‚¤μ μ¥μ κ³Ό λ‹¨μ 

### μ¥μ 

- κ·Όμ›μ§€ μ¦λ…μ΄ κ°€λ¥ν•λ‹¤.
- ν‚¤μ κ΄€λ¦¬μ™€ λ¶„λ°°κ°€ μ©μ΄ν•λ‹¤.
    - ν‚¤μ κ΄€λ¦¬ μΈ΅λ©΄ : μ‚¬μ©μλ¥Ό nμ΄λΌ ν–μ„ λ•, ν‚¤μ κ°μκ°€ λ¶κ³Ό 2nκ°λ§ μƒμ„±
    - ν‚¤μ λ¶„λ°° μΈ΅λ©΄ : ν‚¤ κµν™μ κΈ°λ°€μ„± λ³΄μ¥, ν‚¤ κ³µμ κ°€ ν•„μ” μ—†μ

### λ‹¨μ 

- μ•κ³ λ¦¬μ¦ μν–‰μ΄ λλ¦Ό

```python
from Crypto.PublicKey import RSA
from Crypto import Random

# μ½”λ“ μ§„ν–‰ μ „ Cryptoλ¥Ό μ„¤μΉν•΄μ£Όμ„Έμ”.
# pip install pycryptodome

# λ‚μλ¥Ό μƒμ„±ν•μ—¬ RSA ν‚¤ κ°μ²΄λ¥Ό λ§λ“¤μ–΄ key λ³€μμ— ν• λ‹Ήν•©λ‹λ‹¤.
ransdom_generator = Random.new().read
key = RSA.generate(1024, random_generator)

# κ³µκ°ν‚¤λ¥Ό λ§λ“¤κ³  μ•”νΈν™” ν•©λ‹λ‹¤. 
# encryptedλ” νν” κ°μ²΄λ¥Ό λ°ν™ν•λ©° μ²« λ²μ§Έ μ•„μ΄ν…μ—λ” ν‚¤ μ •λ³΄λ¥Ό, λ‘ λ²μ§Έ μ•„μ΄ν…μ€ ν•­μƒ Noneμ„ λ°ν™ν•©λ‹λ‹¤.
pub_key = key.publickkey()
encrypted = pub_key.encrypt(msg, 32) # κ³µκ°ν‚¤λ΅ μ•”νΈν™”λ¥Ό ν•λ‹¤.
encrypted_msg = encrypted[0]

# μ•”νΈν™” κ²°κ³Όλ¥Ό μ¶λ ¥ν•©λ‹λ‹¤.
print('==== encrypted message ====\n{}\n'.format(encrypted_msg))

# λ³µνΈν™”λ¥Ό μ§„ν–‰ν•©λ‹λ‹¤.
decrypted_msg = key.decrypt(encrypted_msg) # λΉ„λ°€ν‚¤λ΅ λ³µνΈν™” ν•λ‹¤.

# λ³µνΈν™” κ²°κ³Όλ¥Ό μ¶λ ¥ν•©λ‹λ‹¤.
print('==== decrypted message ====\n{}'.format(decrypted_msg))
```

### **λ€μΉ­ν‚¤μ™€ κ³µκ°ν‚¤ μ•”νΈν™” λ°©μ‹μ„ μ μ ν νΌν•©ν•΄λ³΄λ©΄?**

> SSL νƒ„μƒμ μ‹μ΄κ°€ λ¨

λ¨Όμ €, SSL μ— λ€ν•΄μ„ μ κΉ μ§κ³  λ„μ–΄κ°€μ.

SSL μ€ μ›Ήμ„λ²„μ™€ λΈλΌμ°μ € κ°„μ ν†µμ‹ μ„ μ•”νΈν™” ν•΄μ„ μ¤‘κ°„μ— λ„κ°€ κ°€λ΅μ±„λ”λΌλ„ λ‚΄μ©μ„ μ• μ μ—†κ² ν•΄λ‹¤. SSLμ΄ μ μ©λλ©΄Β **https://**Β λ¥Ό μ‚¬μ©ν•μ—¬ μ›Ήμ„λ²„μ— μ ‘κ·Όν•κ² λ©λ‹λ‹¤.

λ€μΉ­ν‚¤ μ•”νΈν™”λ” μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ κ°™μ€ ν‚¤λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•λ―€λ΅ ν‚¤λ¥Ό κ³µμ ν•λ”λ° λ¬Έμ κ°€ μκ³ , λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”λ” κ³µκ°ν‚¤λ¥Ό λ°°ν¬ν•¨μΌλ΅μ¨ ν‚¤ κ³µμ  λ¬Έμ λ” ν•΄κ²° λμ§€λ§, μ²λ¦¬ μ†λ„κ°€ λλ¦° λ¬Έμ κ°€ μλ‹¤.

HTTPS ν†µμ‹ μ—μ„ μ‹¤μ  μ „μ†΅λλ” λ°μ΄ν„°μ μ•”νΈν™”μ—λ” λ€μΉ­ν‚¤ μ•”νΈν™” λ°©μ‹μ„ μ‚¬μ©ν•κ³ , ν‚¤ κµν™μ—λ” λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”λ¥Ό μ‚¬μ©ν•μ—¬ μ΄λ¬ν• λ¬Έμ λ¥Ό ν•΄κ²°ν•κ³  μλ‹¤.

### **CAλ¥Ό λΈλΌμ°μ €λ” μ•κ³  μλ‹¤**

μΈμ¦μ„λ¥Ό μ΄ν•΄ν•λ”λ° κΌ­ μ•κ³  μμ–΄μ•Ό ν•λ” κ²ƒμ΄ CAμ λ¦¬μ¤νΈλ‹¤. λΈλΌμ°μ €λ” λ‚΄λ¶€μ μΌλ΅ CAμ λ¦¬μ¤νΈλ¥Ό λ―Έλ¦¬ νμ•…ν•κ³  μλ‹¤. μ΄ λ§μ€ λΈλΌμ°μ €μ μ†μ¤μ½”λ“ μ•μ— CAμ λ¦¬μ¤νΈκ°€ λ“¤μ–΄μλ‹¤λ” κ²ƒμ΄λ‹¤. λΈλΌμ°μ €κ°€ λ―Έλ¦¬ νμ•…ν•κ³  μλ” CAμ λ¦¬μ¤νΈμ— ν¬ν•¨λμ–΄μ•Όλ§ κ³µμΈλ CAκ°€ λ  μ μλ” κ²ƒμ΄λ‹¤. CAμ λ¦¬μ¤νΈμ™€ ν•¨κ» κ°Β [CAμ κ³µκ°ν‚¤](https://opentutorials.org/course/228/4894#public)λ¥Ό λΈλΌμ°μ €λ” μ΄λ―Έ μ•κ³  μλ‹¤.

![Untitled](\assets\img\public_key\Untitled.png)

## **SSL λ™μ‘ λ°©μ‹**

1) ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ ‘μ†ν•λ‹¤. μ΄ λ‹¨κ³„λ¥Ό Client HelloλΌκ³  ν•λ‹¤. 

2) μ„λ²„λ” Client Helloμ— λ€ν• μ‘λ‹µμΌλ΅ Server Helloλ¥Ό ν•κ² λλ‹¤. 

3) ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ μΈμ¦μ„κ°€ CAμ— μν•΄μ„ λ°κΈ‰λ κ²ƒμΈμ§€λ¥Ό ν™•μΈν•κΈ° μ„ν•΄μ„ ν΄λΌμ΄μ–ΈνΈμ— λ‚΄μ¥λ CA λ¦¬μ¤νΈλ¥Ό ν™•μΈν•λ‹¤. CA λ¦¬μ¤νΈμ— μΈμ¦μ„κ°€ μ—†λ‹¤λ©΄ μ‚¬μ©μμ—κ² κ²½κ³  λ©”μ‹μ§€λ¥Ό μ¶λ ¥ν•λ‹¤. μΈμ¦μ„κ°€ CAμ— μν•΄μ„ λ°κΈ‰λ κ²ƒμΈμ§€λ¥Ό ν™•μΈν•κΈ° μ„ν•΄μ„ ν΄λΌμ΄μ–ΈνΈμ— λ‚΄μ¥λ CAμ κ³µκ°ν‚¤λ¥Ό μ΄μ©ν•΄μ„ μΈμ¦μ„λ¥Ό λ³µνΈν™”ν•λ‹¤. λ³µνΈν™”μ— μ„±κ³µν–λ‹¤λ©΄ μΈμ¦μ„λ” CAμ κ°μΈν‚¤λ΅ μ•”νΈν™”λ λ¬Έμ„μ„μ΄ μ•”μ‹μ μΌλ΅ λ³΄μ¦λ κ²ƒμ΄λ‹¤. μΈμ¦μ„λ¥Ό μ „μ†΅ν• μ„λ²„λ¥Ό λ―Ώμ„ μ μκ² λ κ²ƒμ΄λ‹¤.

ν΄λΌμ΄μ–ΈνΈλ” μƒκΈ° 2λ²μ„ ν†µν•΄μ„ λ°›μ€ μ„λ²„μΒ λλ¤ λ°μ΄ν„°μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μƒμ„±ν•Β λλ¤ λ°μ΄ν„°λ¥Ό μ΅°ν•©ν•΄μ„ pre master secretλΌλ” ν‚¤λ¥Ό μƒμ„±ν•λ‹¤. μ΄ ν‚¤λ” λ’¤μ—μ„ μ‚΄ν΄λ³Ό μ„Έμ… λ‹¨κ³„μ—μ„ λ°μ΄ν„°λ¥Ό μ£Όκ³  λ°›μ„ λ• μ•”νΈν™”ν•κΈ° μ„ν•΄μ„ μ‚¬μ©λ  κ²ƒμ΄λ‹¤.Β κ·ΈλΌ λ¬Έμ λ” μ΄ pre master secret κ°’μ„ μ–΄λ–»κ² μ„λ²„μ—κ² μ „λ‹¬ν•  κ²ƒμΈκ°€μ΄λ‹¤. μ΄ λ• μ‚¬μ©ν•λ” λ°©λ²•μ΄ λ°”λ΅ κ³µκ°ν‚¤ λ°©μ‹μ΄λ‹¤.Β Β κ·ΈλΌ μ„λ²„μ κ³µκ°ν‚¤λ” μ–΄λ–»κ² κµ¬ν•  μ μμ„κΉ? μ„λ²„λ΅λ¶€ν„° λ°›μ€ μΈμ¦μ„ μ•μ— λ“¤μ–΄μλ‹¤. μ΄ μ„λ²„μ κ³µκ°ν‚¤λ¥Ό μ΄μ©ν•΄μ„ pre master secret κ°’μ„ μ•”νΈν™”ν• ν›„μ— μ„λ²„λ΅ μ „μ†΅ν•λ©΄ μ•μ „ν•κ² μ „μ†΅ν•  μ μλ‹¤.

μ΄ λ• μ‚¬μ©ν•  μ•”νΈν™” κΈ°λ²•μ€ λ€μΉ­ν‚¤μ΄κΈ° λ•λ¬Έμ— pre master secret κ°’μ€ μ  3μμ—κ² μ λ€λ΅ λ…Έμ¶λμ–΄μ„λ” μ•λλ‹¤.

μ„λ²„μ κ³µκ°ν‚¤λ΅ pre master secret κ°’μ„ μ•”νΈν™”ν•΄μ„ μ„λ²„λ΅ μ „μ†΅ν•λ©΄ μ„λ²„λ” μμ‹ μ λΉ„κ³µκ°ν‚¤λ΅ μ•μ „ν•κ² λ³µνΈν™” ν•  μ μλ‹¤.

4) μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ „μ†΅ν• pre master secretΒ κ°’μ„ μμ‹ μ λΉ„κ³µκ°ν‚¤λ΅ λ³µνΈν™”ν•λ‹¤. μ΄λ΅μ„ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ λ¨λ‘ pre master secret κ°’μ„ κ³µμ ν•κ² λμ—λ‹¤. κ·Έλ¦¬κ³  μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈλ” λ¨λ‘ μΌλ ¨μ κ³Όμ •μ„ κ±°μ³μ„ pre master secret κ°’μ„ master secret κ°’μΌλ΅ λ§λ“ λ‹¤. master secretλ” session keyλ¥Ό μƒμ„±ν•λ”λ° μ΄ session key κ°’μ„ μ΄μ©ν•΄μ„ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈλ” λ°μ΄ν„°λ¥Ό λ€μΉ­ν‚¤ λ°©μ‹μΌλ΅ μ•”νΈν™” ν• ν›„μ— μ£Όκ³  λ°›λ”λ‹¤. μ΄λ ‡κ²ν•΄μ„ μ„Έμ…ν‚¤λ¥Ό ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ λ¨λ‘ κ³µμ ν•κ² λμ—λ‹¤λ” μ μ„ κΈ°μ–µν•μ.

5) ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„λ” ν•Έλ“μ‰μ΄ν¬ λ‹¨κ³„μ μΆ…λ£λ¥Ό μ„λ΅μ—κ² μ•λ¦°λ‹¤.

### κ·Έλƒ¥ κ³µκ°ν‚¤λ¥Ό μ‚¬μ©ν•λ©΄ λ  κ²ƒμ„ λ€μΉ­ν‚¤μ™€ κ³µκ°ν‚¤λ¥Ό μ΅°ν•©ν•΄μ„ μ‚¬μ©ν•λ” μ΄μ λ” λ¬΄μ—‡μ„κΉ?

κ·Έκ²ƒμ€ κ³µκ°ν‚¤ λ°©μ‹μ΄ λ§μ€ μ»΄ν“¨ν„° νμ›λ¥Ό μ‚¬μ©ν•κΈ° λ•λ¬Έμ΄λ‹¤. λ§μ•½ κ³µκ°ν‚¤λ¥Ό κ·Έλ€λ΅ μ‚¬μ©ν•λ©΄ λ§μ€ μ ‘μ†μ΄ λ°λ¦¬λ” μ„λ²„λ” λ§¤μ° ν° λΉ„μ©μ„ μ§€λ¶ν•΄μ•Ό ν•  κ²ƒμ΄λ‹¤. λ°λ€λ΅ λ€μΉ­ν‚¤λ” μ•”νΈλ¥Ό ν‘Έλ” μ—΄μ‡ μΈ λ€μΉ­ν‚¤λ¥Ό μƒλ€μ—κ² μ „μ†΅ν•΄μ•Ό ν•λ”λ°, μ•”νΈν™”κ°€ λμ§€ μ•μ€ μΈν„°λ„·μ„ ν†µν•΄μ„ ν‚¤λ¥Ό μ „μ†΅ν•λ” κ²ƒμ€ μ„ν—ν•κΈ° λ•λ¬Έμ΄λ‹¤. κ·Έλμ„ μ†λ„λ” λλ¦¬μ§€λ§ λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² μ£Όκ³  λ°›μ„ μ μλ” κ³µκ°ν‚¤ λ°©μ‹μΌλ΅ λ€μΉ­ν‚¤λ¥Ό μ•”νΈν™”ν•κ³ , μ‹¤μ  λ°μ΄ν„°λ¥Ό μ£Όκ³  λ°›μ„ λ•λ” λ€μΉ­ν‚¤λ¥Ό μ΄μ©ν•΄μ„ λ°μ΄ν„°λ¥Ό μ£Όκ³  λ°›λ” κ²ƒμ΄λ‹¤.

μ°Έκ³  μλ£

[https://opentutorials.org/course/228/4894](https://opentutorials.org/course/228/4894)